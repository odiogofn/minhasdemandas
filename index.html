<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema de Tarefas</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background:#0f1115; color:#e8e8e8; }
    .hidden { display:none !important; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px; }
    .card { background:#151923; border:1px solid #242a3a; border-radius:12px; padding:16px; margin-bottom:14px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .col { flex:1; min-width:220px; }
    label { display:block; font-size:12px; margin: 10px 0 6px; color:#b9c0d0; }
    input, select, textarea { width:100%; box-sizing:border-box; padding:10px; border-radius:10px; border:1px solid #2a3145; background:#0f1320; color:#e8e8e8; }
    textarea { resize: vertical; }
    .btn { padding:10px 14px; border-radius:10px; border:1px solid #2a3145; background:#1a2030; color:#fff; cursor:pointer; }
    .btn:hover { filter: brightness(1.1); }
    .btn.primary { background:#2a62ff; border-color:#2a62ff; }
    .btn.danger { background:#ff3b3b; border-color:#ff3b3b; }
    .btn.ghost { background:transparent; }
    .msg { margin-top:10px; font-size:13px; color:#c8d1ff; }
    .muted { color:#9aa4bd; font-size:12px; }
    .nav { display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:14px; }
    .tabs { display:flex; gap:8px; flex-wrap:wrap; }
    .tab { padding:10px 12px; border-radius:10px; border:1px solid #2a3145; background:#11182a; cursor:pointer; color:#fff; }
    .tab.active { background:#2a62ff; border-color:#2a62ff; }
    .badge { padding:8px 10px; border-radius:10px; border:1px solid #2a3145; background:#101727; }
    .list { display:flex; flex-direction:column; gap:10px; }
    .item { background:#101727; border:1px solid #242a3a; border-radius:12px; padding:12px; }
    .top { display:flex; justify-content:space-between; gap:12px; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; align-items:flex-start; }
    .tags { display:flex; gap:6px; flex-wrap:wrap; margin-top:8px; }
    .tag { font-size:12px; padding:6px 8px; border-radius:999px; border:1px solid #2a3145; background:#0f1320; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 820px){ .grid2 { grid-template-columns: 1fr; } }
    .disabled { opacity:.55; pointer-events:none; }
    .stat-pill { padding:10px 12px; border-radius:12px; border:1px solid #2a3145; background:#101727; min-width:140px; }
    .resp-line { display:flex; justify-content:space-between; border-bottom:1px dashed #2a3145; padding:8px 0; }
    .resp-line:last-child { border-bottom:0; }
    .pager { display:flex; gap:10px; align-items:center; justify-content:flex-end; margin-top:10px; flex-wrap:wrap; }

    /* MODAL */
    .modal { position:fixed; inset:0; background:rgba(0,0,0,.6); display:flex; align-items:center; justify-content:center; padding:18px; z-index:999; }
    .modal-box { width:min(920px, 100%); background:#151923; border:1px solid #242a3a; border-radius:14px; overflow:hidden; }
    .modal-head { display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid #242a3a; }
    .modal-body { padding:14px; max-height:70vh; overflow:auto; }
    .modal-foot { display:flex; justify-content:flex-end; gap:10px; padding:12px 14px; border-top:1px solid #242a3a; }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- AUTH -->
    <section id="pageAuth" class="card">
      <h2>Login</h2>
      <div class="row">
        <div class="col">
          <label>Email</label>
          <input id="loginEmail" type="email" placeholder="seu@email.com" autocomplete="username" />
        </div>
        <div class="col">
          <label>Senha</label>
          <input id="loginPass" type="password" placeholder="••••••••" autocomplete="current-password" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button id="btnLogin" type="button" class="btn primary">Entrar</button>
      </div>
      <p id="loginMsg" class="msg"></p>

      <hr style="border:0;border-top:1px solid #242a3a;margin:18px 0;">

      <h2>Cadastro (novo usuário)</h2>
      <div class="row">
        <div class="col">
          <label>Login</label>
          <input id="regLogin" type="text" placeholder="ex: diogo.fn" />
        </div>
        <div class="col">
          <label>Nome e sobrenome</label>
          <input id="regName" type="text" placeholder="Seu Nome" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Email</label>
          <input id="regEmail" type="email" placeholder="seu@email.com" autocomplete="email" />
        </div>
        <div class="col">
          <label>Perfil</label>
          <select id="regRole">
            <option value="SUPORTE">SUPORTE</option>
            <option value="PROGRAMADOR">PROGRAMADOR</option>
            <option value="GESTOR">GESTOR</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Senha</label>
          <input id="regPass" type="password" autocomplete="new-password" />
        </div>
        <div class="col">
          <label>Confirmar senha</label>
          <input id="regPass2" type="password" autocomplete="new-password" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="btnRegister" type="button" class="btn">Cadastrar</button>
      </div>
      <p id="regMsg" class="msg"></p>
    </section>

    <!-- PENDENTE -->
    <section id="pendingBox" class="card hidden">
      <h2>Usuário pendente</h2>
      <p class="muted">Seu cadastro está como <b>PENDENTE</b>. Aguarde um gestor ativar seu acesso.</p>
      <button id="btnLogoutPending" type="button" class="btn">Sair</button>
    </section>

    <!-- NAV -->
    <div id="nav" class="nav hidden">
      <div class="tabs">
        <button class="tab" data-tab="demands" type="button">Demandas</button>
        <button class="tab" data-tab="clients" type="button">Clientes</button>
        <button class="tab hidden" data-tab="manage" type="button">Gestão</button>
      </div>

      <div class="row" style="align-items:center;">
        <span id="userBadge" class="badge hidden"></span>
        <button id="btnLogoutNav" type="button" class="btn">Sair</button>
      </div>
    </div>

    <!-- CLIENTES -->
    <section id="pageClients" class="card hidden">
      <div class="top">
        <div>
          <h2>Clientes</h2>
          <div class="muted">Cadastro e listagem</div>
        </div>
        <div class="actions">
          <button id="btnRefreshClients" type="button" class="btn">Atualizar</button>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h3>Novo cliente</h3>
        <div class="row">
          <div class="col">
            <label>Cliente</label>
            <input id="cCliente" type="text" placeholder="Ex: Prefeitura de X" />
          </div>
          <div class="col">
            <label>Entidade</label>
            <input id="cEntidade" type="text" placeholder="Ex: Folha/Contabilidade" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Tipo Entidade</label>
            <select id="cTipo">
              <option value="CM">CM</option>
              <option value="PM">PM</option>
              <option value="CONSORCIO">CONSORCIO</option>
              <option value="AUTARQUIA">AUTARQUIA</option>
              <option value="INSTITUTO">INSTITUTO</option>
            </select>
          </div>
          <div class="col">
            <label>Estado</label>
            <select id="cEstado">
              <option value="CE">CE</option>
              <option value="MA">MA</option>
              <option value="RN">RN</option>
              <option value="AP">AP</option>
              <option value="PA">PA</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button id="btnCreateClient" type="button" class="btn primary">Salvar cliente</button>
        </div>
        <p id="clientsMsg" class="msg"></p>
      </div>

      <div class="card">
        <div class="row">
          <div class="col">
            <label>Buscar</label>
            <input id="clientSearch" type="text" placeholder="Filtrar na lista..." />
          </div>
        </div>
        <div id="clientsList" class="list" style="margin-top:12px;"></div>
      </div>
    </section>

    <!-- DEMANDAS -->
    <section id="pageDemands" class="card hidden">
      <div class="top">
        <div>
          <h2>Demandas</h2>
          <div class="muted">Dashboard + listagem (paginação) + filtros</div>
        </div>
        <div class="actions">
          <button id="btnRefreshDashboard" type="button" class="btn">Atualizar dashboard</button>
          <button id="btnRefreshDemands" type="button" class="btn">Atualizar lista</button>
        </div>
      </div>

      <!-- Dashboard -->
      <div class="card" style="margin-top:14px;">
        <h3>Dashboard</h3>
        <div class="row" style="margin-top:10px;">
          <div class="col">
            <div class="muted">Contadores por status</div>
            <div id="dashStatus" class="row" style="margin-top:10px;"></div>
          </div>
          <div class="col">
            <div class="muted">Top responsáveis (por volume)</div>
            <div id="dashResp" style="margin-top:10px;"></div>
          </div>
        </div>
        <p id="dashMsg" class="msg"></p>
      </div>

      <!-- Cadastro de demanda -->
      <div class="card">
        <h3>Nova demanda</h3>

        <label>Localize o cliente</label>
        <select id="dClientSelect"></select>

        <div class="row" style="margin-top:10px;">
          <div class="col">
            <label>Cliente</label>
            <input id="dCliente" type="text" readonly />
          </div>
          <div class="col">
            <label>Entidade</label>
            <input id="dEntidade" type="text" readonly />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Tipo Entidade</label>
            <input id="dTipo" type="text" readonly />
          </div>
          <div class="col">
            <label>Estado</label>
            <input id="dEstado" type="text" readonly />
          </div>
        </div>

        <div id="dFields" class="card disabled" style="margin-top:12px;">
          <div class="row">
            <div class="col">
              <label>Responsável</label>
              <input id="dResponsavel" type="text" placeholder="Nome do responsável" />
            </div>
            <div class="col">
              <label>Status</label>
              <select id="dStatus">
                <option value="ABERTURA">ABERTURA</option>
                <option value="PROGRAMACAO">PROGRAMAÇÃO</option>
                <option value="EM_ANALISE">EM ANÁLISE</option>
                <option value="CONCLUIDO">CONCLUÍDO</option>
              </select>
            </div>
          </div>

          <label>Assunto (tags por vírgula)</label>
          <input id="dAssunto" type="text" placeholder="Ex: folha, contracheque, erro" />
          <div id="assuntoPreview" class="tags"></div>

          <label>Atendimento</label>
          <textarea id="dAtendimento" rows="4" placeholder="Descreva o atendimento..."></textarea>

          <div class="row">
            <div class="col">
              <label>Trello (link)</label>
              <input id="dTrello" type="url" placeholder="https://trello.com/..." />
            </div>
            <div class="col">
              <label>Email (código)</label>
              <input id="dEmailCod" type="text" placeholder="Ex: 2025-000123" />
            </div>
          </div>

          <label>Canal de atendimento (tags por vírgula)</label>
          <input id="dCanal" type="text" placeholder="Ex: whatsapp, telefone, email" />
          <div id="canalPreview" class="tags"></div>

          <div id="encaminharBox" class="hidden">
            <label>Encaminhar</label>
            <select id="dEncaminhar"></select>
          </div>

          <div class="row" style="margin-top:10px;">
            <button id="btnCreateDemand" type="button" class="btn primary">Salvar demanda</button>
          </div>
          <p id="demandsMsg" class="msg"></p>
        </div>
      </div>

      <!-- Lista / filtros / paginação -->
      <div class="card">
        <h3>Listagem</h3>

        <div class="row">
          <div class="col">
            <label>Buscar</label>
            <input id="demandSearch" type="text" placeholder="cliente, atendimento, email, trello..." />
          </div>

          <div class="col">
            <label>Status</label>
            <select id="demandStatusFilter">
              <option value="">(todos)</option>
              <option value="ABERTURA">ABERTURA</option>
              <option value="PROGRAMACAO">PROGRAMAÇÃO</option>
              <option value="EM_ANALISE">EM ANÁLISE</option>
              <option value="CONCLUIDO">CONCLUÍDO</option>
            </select>
          </div>

          <div class="col">
            <label>Tamanho da página</label>
            <select id="pageSize">
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="30">30</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:8px;">
          <label style="display:flex; gap:8px; align-items:center; margin:0;">
            <input id="filterMine" type="checkbox" />
            Minhas demandas (SUPORTE)
          </label>
          <label style="display:flex; gap:8px; align-items:center; margin:0;">
            <input id="filterAssignedToMe" type="checkbox" />
            Encaminhadas a mim (PROGRAMADOR)
          </label>
        </div>

        <div id="demandsList" class="list" style="margin-top:12px;"></div>

        <div class="pager">
          <button id="btnPrev" type="button" class="btn">Anterior</button>
          <span id="pagerInfo" class="muted"></span>
          <button id="btnNext" type="button" class="btn">Próxima</button>
        </div>
      </div>
    </section>

    <!-- GESTÃO -->
    <section id="pageManage" class="card hidden">
      <div class="top">
        <div>
          <h2>Gestão</h2>
          <div class="muted">Ativar usuários + top 5 demandas</div>
        </div>
        <div class="actions">
          <button id="btnRefreshManage" type="button" class="btn">Atualizar</button>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h3>Usuários</h3>
        <div id="usersList" class="list"></div>
      </div>

      <div class="row">
        <div class="col card">
          <h3>Top 5 - últimas demandas</h3>
          <div id="top5last" class="list"></div>
        </div>

        <div class="col card">
          <h3>Top 5 por status</h3>
          <label>Status</label>
          <select id="top5Status">
            <option value="ABERTURA">ABERTURA</option>
            <option value="PROGRAMACAO">PROGRAMAÇÃO</option>
            <option value="EM_ANALISE">EM ANÁLISE</option>
            <option value="CONCLUIDO">CONCLUÍDO</option>
          </select>
          <div id="top5statusList" class="list" style="margin-top:10px;"></div>
        </div>
      </div>
    </section>

  </div>

  <!-- MODAL COMENTÁRIOS -->
  <div id="modal" class="modal hidden">
    <div class="modal-box">
      <div class="modal-head">
        <h3 id="modalTitle" style="margin:0;">Atualizações</h3>
        <button id="btnCloseModal" type="button" class="btn">Fechar</button>
      </div>
      <div id="modalBody" class="modal-body"></div>
    </div>
  </div>

  <!-- MODAL EDIÇÃO -->
  <div id="modalEdit" class="modal hidden">
    <div class="modal-box">
      <div class="modal-head">
        <h3 id="editTitle" style="margin:0;">Editar</h3>
        <button id="btnCloseEdit" type="button" class="btn">Fechar</button>
      </div>
      <div id="editBody" class="modal-body"></div>
      <div class="modal-foot">
        <span id="editMsg" class="msg" style="flex:1; margin:0;"></span>
        <button id="btnSaveEdit" type="button" class="btn primary">Salvar alterações</button>
      </div>
    </div>
  </div>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- APP (apenas 1 vez) -->
  <script src="app.js"></script>
</body>
</html>
