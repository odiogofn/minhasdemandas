<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Sistema de Demandas - ASPEC/ITARGET</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- TELA DE LOGIN / CADASTRO -->
  <div id="auth-container" class="auth-wrapper">
    <div class="auth-card">
      <h1>Sistema de Demandas</h1>
      <p class="muted">Acesse com seu email e senha ou solicite cadastro.</p>

      <div class="auth-columns">
        <!-- LOGIN -->
        <div class="auth-column">
          <h2>Login</h2>
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="voce@empresa.com" />

          <label for="login-senha">Senha</label>
          <input type="password" id="login-senha" placeholder="**********" />

          <button id="btn-login" class="btn btn-primary">Entrar</button>
        </div>

        <!-- CADASTRO -->
        <div class="auth-column">
          <h2>Novo Cadastro</h2>

          <label for="cad-nome">Nome</label>
          <input type="text" id="cad-nome" placeholder="Nome completo" />

          <label for="cad-email">Email</label>
          <input type="email" id="cad-email" placeholder="voce@empresa.com" />

          <div class="form-row">
            <div class="col-2">
              <label for="cad-dt-nasc">Data de Nascimento</label>
              <input type="date" id="cad-dt-nasc" />
            </div>
            <div class="col-2">
              <label for="cad-unidade">Unidade</label>
              <select id="cad-unidade">
                <option value="">Selecione...</option>
                <option>ASPEC</option>
                <option>ITARGET</option>
              </select>
            </div>
          </div>

          <label for="cad-tipo">Tipo de conta</label>
          <select id="cad-tipo">
            <option value="">Selecione...</option>
            <option value="PROGRAMADOR">Programador</option>
            <option value="ATENDENTE">Atendente</option>
            <option value="GESTOR">Gestor</option>
          </select>

          <div class="form-row">
            <div class="col-2">
              <label for="cad-senha">Senha</label>
              <input type="password" id="cad-senha" placeholder="até 10 caracteres" />
            </div>
            <div class="col-2">
              <label for="cad-senha2">Confirme a senha</label>
              <input type="password" id="cad-senha2" placeholder="repita a senha" />
            </div>
          </div>

          <button id="btn-cadastrar" class="btn btn-secondary">Cadastrar usuário</button>
        </div>
      </div>

      <p id="auth-status" class="muted status-text"></p>
    </div>
  </div>

  <!-- APLICACAO PRINCIPAL -->
  <div id="app-container" class="app-wrapper" style="display:none;">
    <!-- TOPO -->
    <header class="app-header">
      <div class="header-left">
        <h1>Sistema de Demandas</h1>
        <span id="ajuda-perfil" class="muted"></span>
      </div>
      <div class="header-right">
        <span id="user-label" class="user-label"></span>
        <button id="btn-graficos" class="btn btn-ghost">Gráficos</button>
        <button id="btn-logout" class="btn btn-secondary btn-sm">Sair</button>
      </div>
    </header>

    <!-- STATUS GLOBAL -->
    <div class="status-bar">
      <span id="status-bar">Pronto</span>
    </div>

    <!-- LAYOUT PRINCIPAL 3 COLUNAS (LADO DO GESTOR RESTAURADO) -->
    <main class="main-layout">
      <!-- COLUNA ESQUERDA: AVISOS + CADASTRO DEMANDA -->
      <section class="column column-left">
        <!-- QUADRO DE AVISOS / HISTÓRICO (para gestor em destaque, mas visível a todos) -->
        <div class="card" id="card-avisos">
          <div class="card-header">
            <h2>Quadro de avisos / últimas atualizações</h2>
          </div>
          <div class="card-body aviso-lista" id="quadro-avisos">
            Carregando avisos...
          </div>
        </div>

        <!-- CADASTRO DE DEMANDA -->
        <div class="card" id="sec-cadastro-demanda">
          <div class="card-header">
            <h2>Cadastro de Demanda</h2>
            <span class="muted">Campos pequenos lado a lado para melhor leitura.</span>
          </div>
          <div class="card-body">
            <form id="form-demanda">
              <div class="form-row">
                <div class="col-2">
                  <label for="dem-municipio">Município</label>
                  <input type="text" id="dem-municipio" placeholder="Ex.: FORTALEZA" />
                  <div id="sugs-municipio" class="sugestoes-container"></div>
                </div>
                <div class="col-2">
                  <label for="dem-tipo-entidade">Tipo Entidade</label>
                  <input type="text" id="dem-tipo-entidade" placeholder="CM, PM, IPM, CONSORCIO" />
                  <div id="sugs-tipo-entidade" class="sugestoes-container"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="col-2">
                  <label for="dem-contato-cliente">Contato Cliente</label>
                  <input type="text" id="dem-contato-cliente" placeholder="Nome da pessoa" />
                  <div id="sugs-contato-cliente" class="sugestoes-container"></div>
                </div>
                <div class="col-2">
                  <label for="dem-estado">Estado</label>
                  <select id="dem-estado">
                    <option value="">Selecione...</option>
                    <option>Ceará</option>
                    <option>Maranhão</option>
                    <option>Pará</option>
                    <option>Rio Grande do Norte</option>
                    <option>Amapá</option>
                  </select>
                </div>
              </div>

              <label for="dem-assunto">Assunto</label>
              <input type="text" id="dem-assunto" placeholder="Resumo do problema" />
              <div id="sugs-assunto" class="sugestoes-container"></div>

              <label for="dem-descricao">Descrição detalhada do problema</label>
              <textarea id="dem-descricao" placeholder="Descreva o problema com detalhes"></textarea>

              <div class="form-row">
                <div class="col-2">
                  <label for="dem-programador">Programador (responsável)</label>
                  <input type="text" id="dem-programador" placeholder="Nome do programador" />
                  <div id="sugs-programador" class="sugestoes-container"></div>
                </div>
                <div class="col-2">
                  <label for="dem-forma-atendimento">Forma de atendimento</label>
                  <input type="text" id="dem-forma-atendimento" placeholder="ANYDESK, EMAIL, TELEFONE..." />
                  <div id="sugs-forma-atendimento" class="sugestoes-container"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="col-2">
                  <label for="dem-status">Status</label>
                  <select id="dem-status">
                    <option>ABERTA</option>
                    <option>EM ANÁLISE</option>
                    <option>NA PROGRAMAÇÃO</option>
                    <option>ENCAMINHADA</option>
                    <option>CONCLUÍDA</option>
                  </select>
                </div>
                <div class="col-2">
                  <label for="dem-prioridade">Prioridade</label>
                  <select id="dem-prioridade">
                    <option>BAIXA</option>
                    <option selected>MÉDIA</option>
                    <option>ALTA</option>
                    <option>URGENTE</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="col-2">
                  <label for="dem-link-trello">Link Trello</label>
                  <input type="url" id="dem-link-trello" placeholder="https://..." />
                </div>
                <div class="col-2">
                  <label for="dem-link-email">Link Email/Código</label>
                  <input type="text" id="dem-link-email" placeholder="ID ou link do email" />
                </div>
              </div>

              <button type="submit" class="btn btn-primary">Salvar Demanda</button>
            </form>
          </div>
        </div>
      </section>

      <!-- COLUNA CENTRAL: FILTROS + LISTA DE DEMANDAS -->
      <section class="column column-center">
        <!-- FILTROS -->
        <div class="card">
          <div class="card-header">
            <h2>Filtros</h2>
          </div>
          <div class="card-body filtros-body">
            <div class="form-row">
              <div class="col-2">
                <label for="filtro-busca">Busca (descrição, assunto, código)</label>
                <input type="text" id="filtro-busca" placeholder="Digite para filtrar em tempo real..." />
              </div>
              <div class="col-2">
                <label for="filtro-status">Status</label>
                <select id="filtro-status">
                  <option value="TODOS">Todos</option>
                  <option value="ABERTA">Aberta</option>
                  <option value="EM ANÁLISE">Em análise</option>
                  <option value="NA PROGRAMAÇÃO">Na programação</option>
                  <option value="ENCAMINHADA">Encaminhada</option>
                  <option value="CONCLUÍDA">Concluída</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="col-2">
                <label for="filtro-atendente">Atendente</label>
                <select id="filtro-atendente"></select>
              </div>
              <div class="col-2">
                <label for="filtro-programador">Programador</label>
                <select id="filtro-programador"></select>
              </div>
            </div>

            <div class="form-row">
              <div class="col-2">
                <label for="filtro-municipio">Município</label>
                <select id="filtro-municipio"></select>
              </div>
              <div class="col-2">
                <label for="filtro-estado">Estado</label>
                <select id="filtro-estado"></select>
              </div>
            </div>

            <div class="form-row">
              <div class="col-2">
                <label for="filtro-tipo-entidade">Tipo Entidade</label>
                <select id="filtro-tipo-entidade"></select>
              </div>
              <div class="col-2 filtro-concluidas">
                <label>
                  <input type="checkbox" id="filtro-ocultar-concluidas" />
                  Ocultar concluídas
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- LISTA DE DEMANDAS -->
        <div class="card" id="sec-lista-demandas">
          <div class="card-header">
            <h2>Demandas</h2>
            <span id="total-demandas" class="muted">Total: 0</span>
          </div>
          <div class="card-body">
            <div class="tabela-wrapper">
              <table class="tabela-demandas">
                <thead>
                  <tr>
                    <th>Código</th>
                    <th>Município</th>
                    <th>Assunto</th>
                    <th>Status</th>
                    <th>Prioridade</th>
                  </tr>
                </thead>
                <tbody id="tabela-demandas">
                  <!-- linhas preenchidas via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- COLUNA DIREITA: DETALHES + GESTÃO DE USUÁRIOS (GESTOR) -->
      <section class="column column-right">
        <!-- DETALHES DA DEMANDA -->
        <div class="card" id="sec-detalhes-demanda">
          <div class="card-header">
            <h2>Detalhes da Demanda</h2>
          </div>
          <div class="card-body detalhes-body">
            <input type="hidden" id="det-demanda-id" />

            <div class="detalhes-grid">
              <div>
                <span class="label">Código:</span>
                <span id="det-codigo" class="valor"></span>
              </div>
              <div>
                <span class="label">Município:</span>
                <span id="det-municipio" class="valor"></span>
              </div>
              <div>
                <span class="label">Tipo Entidade:</span>
                <span id="det-tipo-entidade" class="valor"></span>
              </div>
              <div>
                <span class="label">Contato Cliente:</span>
                <span id="det-contato-cliente" class="valor"></span>
              </div>
              <div>
                <span class="label">Estado:</span>
                <span id="det-estado" class="valor"></span>
              </div>
              <div>
                <span class="label">Assunto:</span>
                <span id="det-assunto" class="valor"></span>
              </div>
              <div class="detalhes-linha">
                <span class="label">Descrição:</span>
                <span id="det-descricao" class="valor"></span>
              </div>
              <div>
                <span class="label">Programador:</span>
                <span id="det-programador" class="valor"></span>
              </div>
              <div>
                <span class="label">Forma Atendimento:</span>
                <span id="det-forma-atendimento" class="valor"></span>
              </div>
              <div>
                <span class="label">Prioridade:</span>
                <span id="det-prioridade" class="valor"></span>
              </div>
              <div>
                <span class="label">Status:</span>
                <span id="det-status" class="valor"></span>
              </div>
              <div>
                <span class="label">Atendente:</span>
                <span id="det-atendente" class="valor"></span>
              </div>
              <div>
                <span class="label">Link Trello:</span>
                <span id="det-link-trello" class="valor"></span>
              </div>
              <div>
                <span class="label">Link Email:</span>
                <span id="det-link-email" class="valor"></span>
              </div>
              <div>
                <span class="label">Criado em:</span>
                <span id="det-criado-em" class="valor"></span>
              </div>
            </div>

            <!-- HISTÓRICO DE ATUALIZAÇÕES (FICA BEM VISÍVEL) -->
            <h3>Histórico de atualizações</h3>
            <ul id="lista-atualizacoes" class="lista-atualizacoes">
              <!-- preenchido via JS -->
            </ul>

            <!-- NOVA ATUALIZAÇÃO -->
            <form id="form-atualizacao-demanda" class="form-atualizacao">
              <label for="nova-atualizacao-texto">Nova atualização</label>
              <textarea id="nova-atualizacao-texto" placeholder="Descreva o andamento..."></textarea>
              <button type="submit" class="btn btn-primary btn-sm">Registrar atualização</button>
            </form>
          </div>
        </div>

        <!-- GESTÃO DE USUÁRIOS (VISÍVEL APENAS PARA GESTOR VIA JS) -->
        <div class="card" id="sec-painel-gestor">
          <div class="card-header">
            <h2>Gestão de Usuários</h2>
            <span class="muted">Aprovar, inativar e editar usuários.</span>
          </div>
          <div class="card-body">
            <div class="gestor-usuarios-wrapper">
              <h3>Usuários cadastrados</h3>
              <div class="tabela-wrapper">
                <table class="tabela-demandas">
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Email</th>
                      <th>Unidade</th>
                      <th>Tipo</th>
                      <th>Status</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="tabela-usuarios-gestor"></tbody>
                </table>
              </div>
              <p class="muted" id="texto-gestor-usuarios"></p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
