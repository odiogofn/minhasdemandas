<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Sistema de Demandas</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>
  </head>
  <body>
    <!-- TELA DE LOGIN / CADASTRO -->
    <div id="auth-container" class="card">
      <h2>Acesso ao Sistema</h2>
      <div class="form-group">
        <label for="login-email">Email</label>
        <input type="email" id="login-email" />
      </div>
      <div class="form-group">
        <label for="login-senha">Senha</label>
        <input type="password" id="login-senha" />
      </div>
      <button id="btn-login" class="btn btn-primary" type="button">
        Entrar
      </button>

      <hr />

      <h2>Novo Cadastro</h2>
      <div class="form-group">
        <label for="cad-nome">Nome</label>
        <input type="text" id="cad-nome" />
      </div>
      <div class="form-group">
        <label for="cad-email">Email</label>
        <input type="email" id="cad-email" />
      </div>
      <div class="form-group">
        <label for="cad-dt-nasc">Data de Nascimento</label>
        <input type="date" id="cad-dt-nasc" />
      </div>
      <div class="form-group">
        <label for="cad-unidade">Unidade</label>
        <select id="cad-unidade">
          <option value="">Selecione...</option>
          <option>ASPEC</option>
          <option>ITARGET</option>
        </select>
      </div>
      <div class="form-row">
        <div class="col-2">
          <label for="cad-senha">Senha</label>
          <input type="password" id="cad-senha" />
        </div>
        <div class="col-2">
          <label for="cad-senha2">Confirme a Senha</label>
          <input type="password" id="cad-senha2" />
        </div>
      </div>
      <button id="btn-cadastrar" class="btn btn-secondary" type="button">
        Cadastrar usuário
      </button>

      <div id="auth-status" class="muted" style="margin-top: 8px"></div>
    </div>

    <!-- APLICACAO PRINCIPAL -->
    <div id="app-container" style="display: none">
      <header>
        <div><strong>Sistema de Demandas</strong></div>
        <div class="right">
          <span id="user-label" class="muted"></span>
          <button id="btn-graficos" class="btn btn-secondary btn-sm" type="button">
            Gráficos
          </button>
          <button id="btn-logout" class="btn btn-secondary btn-sm" type="button">
            Sair
          </button>
        </div>
      </header>

      <main>
        <p id="ajuda-perfil" class="muted"></p>

        <div id="layout-principal">
          <!-- COLUNA ESQUERDA: cadastro + lista -->
          <div>
            <!-- CADASTRO DE DEMANDA -->
            <section id="sec-cadastro-demanda" class="card">
              <h2>Nova Demanda</h2>
              <form id="form-demanda">
                <div class="form-row">
                  <div class="col-2">
                    <label for="dem-municipio">Município</label>
                    <input type="text" id="dem-municipio" />
                    <div id="sugs-municipio" class="muted" style="margin-top: 4px"></div>
                  </div>
                  <div class="col-2">
                    <label for="dem-tipo-entidade">Tipo Entidade (CM, PM, CONSORCIO, IPM)</label>
                    <input type="text" id="dem-tipo-entidade" />
                    <div
                      id="sugs-tipo-entidade"
                      class="muted"
                      style="margin-top: 4px"
                    ></div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-2">
                    <label for="dem-contato-cliente">Contato Cliente</label>
                    <input type="text" id="dem-contato-cliente" />
                    <div
                      id="sugs-contato-cliente"
                      class="muted"
                      style="margin-top: 4px"
                    ></div>
                  </div>
                  <div class="col-2">
                    <label for="dem-estado">Estado</label>
                    <select id="dem-estado">
                      <option value="">Selecione...</option>
                      <option value="MARANHÃO">Maranhão</option>
                      <option value="CEARÁ">Ceará</option>
                      <option value="PARÁ">Pará</option>
                      <option value="RIO GRANDE DO NORTE">Rio Grande do Norte</option>
                      <option value="AMAPÁ">Amapá</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="dem-assunto">Assunto</label>
                  <input type="text" id="dem-assunto" />
                  <div id="sugs-assunto" class="muted" style="margin-top: 4px"></div>
                </div>

                <div class="form-group">
                  <label for="dem-descricao">Descrição do Problema</label>
                  <textarea id="dem-descricao"></textarea>
                </div>

                <div class="form-row">
                  <div class="col-2">
                    <label for="dem-programador">Programador</label>
                    <input type="text" id="dem-programador" />
                    <div
                      id="sugs-programador"
                      class="muted"
                      style="margin-top: 4px"
                    ></div>
                  </div>
                  <div class="col-2">
                    <label for="dem-forma-atendimento"
                      >Forma de Atendimento (AnyDesk, TeamViewer, etc – use vírgula)</label
                    >
                    <input type="text" id="dem-forma-atendimento" />
                    <div
                      id="sugs-forma-atendimento"
                      class="muted"
                      style="margin-top: 4px"
                    ></div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-2">
                    <label for="dem-prioridade">Prioridade</label>
                    <select id="dem-prioridade">
                      <option>BAIXA</option>
                      <option selected>MÉDIA</option>
                      <option>ALTA</option>
                      <option>URGENTE</option>
                    </select>
                  </div>
                  <div class="col-2">
                    <label for="dem-status">Status</label>
                    <select id="dem-status">
                      <option>ABERTA</option>
                      <option>EM ANÁLISE</option>
                      <option>NA PROGRAMAÇÃO</option>
                      <option>CONCLUÍDA</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="col-2">
                    <label for="dem-link-trello">Link Trello</label>
                    <input type="text" id="dem-link-trello" />
                  </div>
                  <div class="col-2">
                    <label for="dem-link-email">Link/ID E-mail</label>
                    <input type="text" id="dem-link-email" />
                  </div>
                </div>

                <button type="submit" class="btn btn-primary" style="margin-top: 10px">
                  Salvar Demanda
                </button>

                <div id="status-bar"></div>
              </form>
            </section>

            <!-- LISTA DE DEMANDAS -->
            <section id="sec-lista-demandas" class="card">
              <h2>Demandas</h2>

              <div class="filtros-row">
                <div>
                  <label for="filtro-busca">Busca</label>
                  <input
                    type="text"
                    id="filtro-busca"
                    placeholder="Descrição, assunto ou código..."
                  />
                </div>
                <div>
                  <label for="filtro-status">Status</label>
                  <select id="filtro-status">
                    <option value="TODOS">Todos</option>
                    <option value="ABERTA">Aberta</option>
                    <option value="EM ANÁLISE">Em Análise</option>
                    <option value="NA PROGRAMAÇÃO">Na Programação</option>
                    <option value="CONCLUÍDA">Concluída</option>
                  </select>
                </div>
                <div>
                  <label for="filtro-atendente">Atendente</label>
                  <select id="filtro-atendente"></select>
                </div>
                <div>
                  <label for="filtro-programador">Programador</label>
                  <select id="filtro-programador"></select>
                </div>
              </div>

              <div class="filtros-row">
                <div>
                  <label for="filtro-municipio">Município</label>
                  <select id="filtro-municipio"></select>
                </div>
                <div>
                  <label for="filtro-estado">Estado</label>
                  <select id="filtro-estado"></select>
                </div>
                <div>
                  <label for="filtro-tipo-entidade">Tipo Entidade</label>
                  <select id="filtro-tipo-entidade"></select>
                </div>
                <div style="display: flex; align-items: flex-end; gap: 4px">
                  <input
                    type="checkbox"
                    id="filtro-ocultar-concluidas"
                    style="width: auto"
                  />
                  <label for="filtro-ocultar-concluidas" style="margin: 0; font-weight: 400"
                    >Ocultar concluídas</label
                  >
                </div>
              </div>

              <div class="muted" id="total-demandas" style="margin-bottom: 4px"></div>

              <div style="max-height: 360px; overflow: auto">
                <table>
                  <thead>
                    <tr>
                      <th>Código</th>
                      <th>Município</th>
                      <th>Assunto</th>
                      <th>Status</th>
                      <th>Prioridade</th>
                    </tr>
                  </thead>
                  <tbody id="tabela-demandas"></tbody>
                </table>
              </div>
            </section>
          </div>

          <!-- COLUNA DIREITA: detalhes + painel gestor -->
          <div>
            <!-- DETALHES DEMANDA -->
            <section id="sec-detalhes-demanda" class="card" style="display: none">
              <h2>Detalhes da Demanda</h2>
              <input type="hidden" id="det-demanda-id" />

              <p>
                <strong>Código:</strong> <span id="det-codigo">-</span><br />
                <strong>Município:</strong> <span id="det-municipio">-</span><br />
                <strong>Tipo Entidade:</strong> <span id="det-tipo-entidade">-</span><br />
                <strong>Contato Cliente:</strong> <span id="det-contato-cliente">-</span><br />
                <strong>Estado:</strong> <span id="det-estado">-</span><br />
                <strong>Assunto:</strong> <span id="det-assunto">-</span><br />
                <strong>Descrição:</strong> <span id="det-descricao">-</span><br />
                <strong>Programador:</strong> <span id="det-programador">-</span><br />
                <strong>Forma Atendimento:</strong>
                <span id="det-forma-atendimento">-</span><br />
                <strong>Prioridade:</strong> <span id="det-prioridade">-</span><br />
                <strong>Status:</strong> <span id="det-status">-</span><br />
                <strong>Atendente:</strong> <span id="det-atendente">-</span><br />
                <strong>Link Trello:</strong> <span id="det-link-trello">-</span><br />
                <strong>Link Email:</strong> <span id="det-link-email">-</span><br />
                <strong>Criado em:</strong> <span id="det-criado-em">-</span>
              </p>

              <h3>Atualizações</h3>
              <ul id="lista-atualizacoes"></ul>

              <form id="form-atualizacao-demanda" style="margin-top: 8px">
                <label for="nova-atualizacao-texto">Nova atualização</label>
                <textarea id="nova-atualizacao-texto"></textarea>
                <button type="submit" class="btn btn-primary" style="margin-top: 4px">
                  Registrar atualização
                </button>
              </form>
            </section>

            <!-- PAINEL GESTOR (PLACEHOLDER) -->
            <section id="sec-painel-gestor" class="card" style="display: none">
              <h2>Painel do Gestor</h2>
              <p class="muted">
                Aqui você pode incluir:
              </p>
              <ul class="muted">
                <li>Últimas 10 demandas por status (cadastradas, encaminhadas, etc.).</li>
                <li>Últimas 10 demandas por Estado.</li>
                <li>Tempo médio entre abertura e conclusão.</li>
                <li>Produção por programador / atendente.</li>
              </ul>
            </section>
          </div>
        </div>
      </main>
    </div>

    <script src="app.js"></script>
  </body>
</html>
