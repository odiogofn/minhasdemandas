<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Sistema de Demandas - Caminho A (Auth Supabase)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>

  <!-- CSS externo -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- TELA DE LOGIN / CADASTRO -->
  <div id="auth-container" class="card auth-card">
    <h1>Sistema de Demandas</h1>
    <p class="muted">Acesse com seu email e senha ou fa√ßa um novo cadastro.</p>

    <div class="auth-columns">
      <!-- Login -->
      <div class="auth-col">
        <h2>Entrar</h2>
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="seuemail@exemplo.com" />
        </div>
        <div class="form-group">
          <label for="login-senha">Senha</label>
          <input type="password" id="login-senha" placeholder="Sua senha" />
        </div>
        <button id="btn-login" class="btn btn-primary" type="button">Entrar</button>
      </div>

      <!-- Cadastro -->
      <div class="auth-col">
        <h2>Novo cadastro</h2>

        <div class="form-group">
          <label for="cad-nome">Nome completo</label>
          <input type="text" id="cad-nome" placeholder="Seu nome" />
        </div>

        <div class="form-group">
          <label for="cad-email">Email</label>
          <input type="email" id="cad-email" placeholder="seuemail@exemplo.com" />
        </div>

        <div class="form-row">
          <div class="col-2">
            <label for="cad-dt-nasc">Data de nascimento</label>
            <input type="date" id="cad-dt-nasc" />
          </div>
          <div class="col-2">
            <label for="cad-unidade">Unidade</label>
            <select id="cad-unidade">
              <option value="">Selecione...</option>
              <option value="ASPEC">ASPEC</option>
              <option value="ITARGET">ITARGET</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="cad-tipo">Tipo de conta</label>
          <select id="cad-tipo">
            <option value="">Selecione...</option>
            <option value="PROGRAMADOR">Programador</option>
            <option value="ATENDENTE">Atendente</option>
            <option value="GESTOR">Gestor</option>
          </select>
        </div>

        <div class="form-row">
          <div class="col-2">
            <label for="cad-senha">Senha (m√°x. 10 caracteres, letras e n√∫meros)</label>
            <input type="password" id="cad-senha" />
          </div>
          <div class="col-2">
            <label for="cad-senha2">Confirme a senha</label>
            <input type="password" id="cad-senha2" />
          </div>
        </div>

        <button id="btn-cadastrar" class="btn btn-secondary" type="button">
          Cadastrar usu√°rio
        </button>
      </div>
    </div>

    <div id="auth-status" class="muted" style="margin-top:10px;"></div>
  </div>

  <!-- APLICATIVO PRINCIPAL -->
  <div id="app-container" style="display:none;">
    <header class="topbar">
      <div class="topbar-left">
        <strong>Sistema de Demandas</strong>
        <span id="ajuda-perfil" class="muted small"></span>
      </div>
      <div class="topbar-right">
        <span id="user-label" class="muted small"></span>
        <span class="badge badge-online">Supabase conectado</span>
        <button id="btn-graficos" class="btn btn-secondary btn-sm" type="button">Gr√°ficos</button>
        <button id="btn-logout" class="btn btn-danger btn-sm" type="button">Sair</button>
      </div>
    </header>

    <main class="main-layout">
      <section class="card" id="sec-cadastro-demanda">
        <h2>Cadastro de demanda</h2>
        <p class="muted small">
          Campos pequenos j√° est√£o lado a lado. Alguns campos sugerem op√ß√µes abaixo √† medida que voc√™ cadastra mais demandas.
        </p>

        <form id="form-demanda">
          <!-- Linha 1: Munic√≠pio, Tipo Entidade, Estado -->
          <div class="form-row">
            <div class="col-3">
              <label for="dem-municipio">Munic√≠pio (cliente)</label>
              <input type="text" id="dem-municipio" placeholder="Crate√∫s, Milagres, etc." />
              <div id="sugs-municipio" class="chips-container"></div>
            </div>
            <div class="col-3">
              <label for="dem-tipo-entidade">Tipo Entidade (CM, PM, CONSORCIO, IPM)</label>
              <input type="text" id="dem-tipo-entidade" placeholder="PM, CM, IPM, Cons√≥rcio..." />
              <div id="sugs-tipo-entidade" class="chips-container"></div>
            </div>
            <div class="col-3">
              <label for="dem-estado">Estado</label>
              <select id="dem-estado">
                <option value="">Selecione...</option>
                <option value="CE">Cear√°</option>
                <option value="MA">Maranh√£o</option>
                <option value="PA">Par√°</option>
                <option value="RN">Rio Grande do Norte</option>
                <option value="AP">Amap√°</option>
              </select>
            </div>
          </div>

          <!-- Linha 2: Contato cliente, Assunto -->
          <div class="form-row">
            <div class="col-3">
              <label for="dem-contato-cliente">Contato cliente</label>
              <input type="text" id="dem-contato-cliente" placeholder="Nome da pessoa de contato" />
              <div id="sugs-contato-cliente" class="chips-container"></div>
            </div>
            <div class="col-3">
              <label for="dem-assunto">Assunto (tag√°vel)</label>
              <input type="text" id="dem-assunto" placeholder="Resumo curto do problema" />
              <div id="sugs-assunto" class="chips-container"></div>
            </div>
          </div>

          <!-- Linha 3: Programador, Forma de atendimento -->
          <div class="form-row">
            <div class="col-3">
              <label for="dem-programador">Programador (tag√°vel)</label>
              <input type="text" id="dem-programador" placeholder="Jonas, Carmelo, Ciro..." />
              <div id="sugs-programador" class="chips-container"></div>
            </div>
            <div class="col-3">
              <label for="dem-forma-atendimento">Forma de atendimento (tag√°vel)</label>
              <input type="text" id="dem-forma-atendimento" placeholder="AnyDesk, TeamViewer, Hangouts..." />
              <div id="sugs-forma-atendimento" class="chips-container"></div>
            </div>
          </div>

          <!-- Linha 4: Status, Prioridade -->
          <div class="form-row">
            <div class="col-3">
              <label for="dem-status">Status</label>
              <select id="dem-status">
                <option value="ABERTA">Aberta</option>
                <option value="EM AN√ÅLISE">Em an√°lise</option>
                <option value="NA PROGRAMA√á√ÉO">Na programa√ß√£o</option>
                <option value="ENCAMINHADA">Encaminhada</option>
                <option value="CONCLU√çDA">Conclu√≠da</option>
              </select>
            </div>
            <div class="col-3">
              <label for="dem-prioridade">Prioridade</label>
              <select id="dem-prioridade">
                <option value="BAIXA">Baixa</option>
                <option value="M√âDIA" selected>M√©dia</option>
                <option value="ALTA">Alta</option>
                <option value="URGENTE">Urgente</option>
              </select>
            </div>
          </div>

          <!-- Linha 5: links -->
          <div class="form-row">
            <div class="col-3">
              <label for="dem-link-trello">Link Trello</label>
              <input type="url" id="dem-link-trello" placeholder="https://trello.com/..." />
            </div>
            <div class="col-3">
              <label for="dem-link-email">Link/ID do e-mail</label>
              <input type="text" id="dem-link-email" placeholder="C√≥digo ou link do e-mail" />
            </div>
          </div>

          <!-- Descri√ß√£o -->
          <div class="form-group">
            <label for="dem-descricao">Descri√ß√£o detalhada</label>
            <textarea id="dem-descricao" placeholder="Descreva o problema com detalhes..."></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Salvar demanda</button>
          <span id="status-bar" class="muted small" style="margin-left:10px;">Pronto</span>
        </form>
      </section>

      <!-- LISTA DE DEMANDAS -->
      <section class="card" id="sec-lista-demandas">
        <h2>Demandas cadastradas</h2>

        <div class="filters-row">
          <div class="filter-item">
            <label for="filtro-busca">Busca r√°pida</label>
            <input type="text" id="filtro-busca" placeholder="Descri√ß√£o, assunto ou c√≥digo..." />
          </div>
          <div class="filter-item small">
            <label class="checkbox-inline">
              <input type="checkbox" id="filtro-ocultar-concluidas" />
              Ocultar conclu√≠das
            </label>
          </div>
        </div>

        <div class="filters-row">
          <div class="filter-item">
            <label for="filtro-status">Status</label>
            <select id="filtro-status">
              <option value="TODOS">Todos</option>
              <option value="ABERTA">Aberta</option>
              <option value="EM AN√ÅLISE">Em an√°lise</option>
              <option value="NA PROGRAMA√á√ÉO">Na programa√ß√£o</option>
              <option value="ENCAMINHADA">Encaminhada</option>
              <option value="CONCLU√çDA">Conclu√≠da</option>
            </select>
          </div>
          <div class="filter-item">
            <label for="filtro-atendente">Atendente</label>
            <select id="filtro-atendente"></select>
          </div>
          <div class="filter-item">
            <label for="filtro-programador">Programador</label>
            <select id="filtro-programador"></select>
          </div>
          <div class="filter-item">
            <label for="filtro-municipio">Munic√≠pio</label>
            <select id="filtro-municipio"></select>
          </div>
          <div class="filter-item">
            <label for="filtro-estado">Estado</label>
            <select id="filtro-estado"></select>
          </div>
          <div class="filter-item">
            <label for="filtro-tipo-entidade">Tipo Entidade</label>
            <select id="filtro-tipo-entidade"></select>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>C√≥digo</th>
                <th>Munic√≠pio</th>
                <th>Assunto</th>
                <th>Status</th>
                <th>Prioridade</th>
              </tr>
            </thead>
            <tbody id="tabela-demandas"></tbody>
          </table>
        </div>
        <div class="muted small" id="total-demandas">Total: 0</div>
      </section>

      <!-- DETALHES DA DEMANDA -->
      <section class="card" id="sec-detalhes-demanda" style="display:none;">
        <h2>Detalhes da demanda</h2>

        <input type="hidden" id="det-demanda-id" />

        <div class="det-grid">
          <div>
            <strong>C√≥digo:</strong> <span id="det-codigo"></span><br />
            <strong>Munic√≠pio:</strong> <span id="det-municipio"></span><br />
            <strong>Tipo entidade:</strong> <span id="det-tipo-entidade"></span><br />
            <strong>Contato cliente:</strong> <span id="det-contato-cliente"></span><br />
            <strong>Estado:</strong> <span id="det-estado"></span><br />
          </div>
          <div>
            <strong>Assunto:</strong> <span id="det-assunto"></span><br />
            <strong>Programador:</strong> <span id="det-programador"></span><br />
            <strong>Forma de atendimento:</strong> <span id="det-forma-atendimento"></span><br />
            <strong>Prioridade:</strong> <span id="det-prioridade"></span><br />
            <strong>Status:</strong> <span id="det-status"></span><br />
          </div>
          <div>
            <strong>Atendente:</strong> <span id="det-atendente"></span><br />
            <strong>Link Trello:</strong> <span id="det-link-trello"></span><br />
            <strong>Link/ID Email:</strong> <span id="det-link-email"></span><br />
            <strong>Criado em:</strong> <span id="det-criado-em"></span><br />
          </div>
        </div>

        <div class="form-group">
          <label>Descri√ß√£o</label>
          <p id="det-descricao" class="det-descricao"></p>
        </div>

        <hr />

        <h3>Atualiza√ß√µes de andamento</h3>
        <ul id="lista-atualizacoes" class="lista-atualizacoes"></ul>

        <form id="form-atualizacao-demanda">
          <label for="nova-atualizacao-texto">Nova atualiza√ß√£o</label>
          <textarea id="nova-atualizacao-texto" placeholder="Descreva o andamento..."></textarea>
          <button type="submit" class="btn btn-primary btn-sm" style="margin-top:6px;">
            Registrar atualiza√ß√£o
          </button>
        </form>
      </section>

      <!-- PAINEL DO GESTOR (base) -->
      <section class="card" id="sec-painel-gestor" style="display:none;">
        <h2>Painel do gestor</h2>
        <p class="muted small">
          Aqui voc√™ poder√° ver produ√ß√£o por usu√°rio, √∫ltimos cadastros e, em vers√µes futuras, aprovar/inativar usu√°rios.
        </p>
        <div class="muted small">Em constru√ß√£o üòÑ ‚Äì mas j√° carregamos as demandas para montar gr√°ficos.</div>
      </section>
    </main>
  </div>

  <!-- JS DO APP -->
  <script src="app.js"></script>
</body>
</html>
